<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application de Dessin (Canvas)</title>

    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --danger-color: #e74c3c;
        --light-color: #ecf0f1;
        --dark-color: #2c3e50;
        --background-color: #ffffff;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: var(--light-color);
        color: var(--dark-color);
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }

      h1 {
        margin-bottom: 1rem;
        background: linear-gradient(
          90deg,
          rgba(68, 207, 186, 1) 0%,
          rgba(29, 167, 253, 1) 50%,
          rgba(118, 72, 217, 1) 100%
        );
        background-clip: text;
        color: transparent;
        display: inline-block;
        font-weight: 800;
        font-size: 2.5rem;
      }

      .toolbar {
        background: linear-gradient(
          90deg,
          rgba(68, 207, 186, 1) 0%,
          rgba(29, 167, 253, 1) 50%,
          rgba(118, 72, 217, 1) 100%
        );
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 0.8rem 1rem;
        margin-bottom: 1rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
        justify-content: center;
      }

      .tool-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.25rem 0.5rem;
      }

      label {
        font-weight: bold;
        font-size: 0.9rem;
        margin-right: 0.2rem;
        display: none;
      }

      .icon-button {
        background-color: white;
        border: none;
        padding: 0.5rem;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        width: 45px;
        height: 45px;
      }

      .icon-button:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .icon-button.active {
        background-color: var(--primary-color);
        color: white;
      }

      #colorPickerContainer {
        position: relative;
        overflow: hidden;
        padding: 0;
      }

      #colorPickerContainer img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        padding: 4px;
      }

      #colorPickerContainer input[type="color"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      #colorPickerContainer:hover {
        opacity: 0.8;
      }

      .range-popup {
        position: relative;
      }

      .range-display {
        display: none;
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        align-items: center;
        gap: 5px;
        background-color: var(--background-color);
        border: 1px solid #ccc;
        padding: 0.5rem 0.8rem;
        border-radius: 5px;
        font-size: 0.9rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        min-width: 120px;
        animation: fadeIn 0.15s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translate(-50%, -10px);
        }
        to {
          opacity: 1;
          transform: translate(-50%, 0);
        }
      }

      .range-popup.open .range-display {
        display: flex;
      }

      .range-display input[type="range"] {
        width: 80px;
        margin: 0;
        height: 5px;
        opacity: 0.7;
        border-radius: 5px;
      }

      .range-display input[type="range"]:hover {
        cursor: grab;
      }

      .range-display input[type="range"]:active {
        cursor: grabbing;
      }

      .action-button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: bold;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        line-height: 1;
      }

      .action-button img {
        height: 20px;
        filter: invert(100%);
      }

      .action-button:hover {
        transform: translateY(-2px);
      }

      #clearButton {
        background-color: var(--danger-color);
      }

      #clearButton:hover {
        background-color: #ae2727;
      }

      #saveButton {
        background-color: var(--secondary-color);
      }

      #saveButton:hover {
        background-color: rgb(15, 139, 15);
      }

      .icon-button::before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 120%;
        background-color: var(--dark-color);
        color: white;
        padding: 0.4rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
      }

      .icon-button:hover::before {
        opacity: 1;
      }

      canvas {
        border: 2px solid var(--dark-color);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        cursor: crosshair;
      }

      .shortcuts {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: #555;
        text-align: center;
      }

      img {
        width: auto;
        height: 25px;
      }

      .icon-button.active img {
        filter: invert(100%);
      }

      #colorPickerContainer.active img {
        filter: none;
      }

      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: var(--background-color);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 400px;
        animation: modalAppear 0.3s ease-out;
      }

      @keyframes modalAppear {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-content h3 {
        margin-top: 0;
        color: var(--danger-color);
      }

      .modal-actions {
        margin-top: 1.5rem;
        display: flex;
        justify-content: center;
        gap: 1rem;
      }

      .modal-button {
        padding: 0.7rem 1.5rem;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }

      #confirmClear {
        background-color: var(--danger-color);
        color: white;
      }

      #confirmClear:hover {
        background-color: #c0392b;
      }

      #cancelClear {
        background-color: var(--light-color);
        color: var(--dark-color);
        border: 1px solid #ccc;
      }

      #cancelClear:hover {
        background-color: #ddd;
      }
    </style>
  </head>
  <body>
    <h1>Application de Dessin</h1>

    <div class="toolbar">
      <div class="tool-group">
        <div id="colorPickerContainer" class="icon-button">
          <img src="icons/color-wheel.png" alt="Couleur" />
          <input type="color" id="colorPicker" value="#000000" />
        </div>
      </div>

      <div class="tool-group">
        <div id="sizeRangePopup" class="range-popup">
          <button
            id="sizeButton"
            class="icon-button"
            data-tooltip="Taille du trait"
          >
            <img src="icons/size.png" alt="size" />
          </button>
          <div class="range-display" id="sizeRangeDisplay">
            <input type="range" id="brushSize" min="1" max="50" value="5" />
            <span id="brushSizeValue">5</span>
          </div>
        </div>

        <div id="opacityRangePopup" class="range-popup">
          <button id="opacityButton" class="icon-button" data-tooltip="Opacité">
            <img src="icons/opacity.png" alt="opacity" />
          </button>
          <div class="range-display" id="opacityRangeDisplay">
            <input
              type="range"
              id="opacitySlider"
              min="1"
              max="100"
              value="100"
            />
            <span id="opacityValue">100%</span>
          </div>
        </div>
      </div>

      <div class="tool-group">
        <button class="icon-button" id="brushButton" data-tooltip="Pinceau (B)">
          <img src="icons/paint-brush.png" alt="paint brush" />
        </button>
        <button class="icon-button" id="eraserButton" data-tooltip="Gomme (E)">
          <img src="icons/eraser.png" alt="eraser" />
        </button>
        <button
          class="icon-button"
          id="fillButton"
          data-tooltip="Pot de peinture (F)"
        >
          <img src="icons/paint-bucket.png" alt="paint-bucket" />
        </button>
      </div>

      <div class="tool-group">
        <button
          class="action-button"
          id="clearButton"
          data-tooltip="Effacer tout (C)"
        >
          <img src="icons/trash-can.png" alt="delete" /> Effacer
        </button>
        <button
          class="action-button"
          id="saveButton"
          data-tooltip="Sauvegarder (S)"
        >
          <img src="icons/download.png" alt="save as" /> Sauvegarder
        </button>
      </div>
    </div>

    <canvas id="drawingCanvas" width="800" height="600"></canvas>

    <div class="shortcuts">
      Raccourcis : <b>B</b> = Pinceau, <b>E</b> = Gomme, <b>F</b> = Remplir,
      <b>C</b> = Effacer, <b>S</b> = Sauvegarder, <b>Esc</b> = Sortir d'une
      boite de dialogue
    </div>

    <div id="clearModal" class="modal-overlay">
      <div class="modal-content">
        <h3>Confirmer l'effacement</h3>
        <p>
          Êtes-vous sûr de vouloir effacer tout le dessin ? Cette action est
          irréversible.
        </p>
        <div class="modal-actions">
          <button class="modal-button" id="confirmClear">Oui, effacer</button>
          <button class="modal-button" id="cancelClear">Annuler</button>
        </div>
      </div>
    </div>

    <div id="saveModal" class="modal-overlay">
      <div class="modal-content">
        <h3 style="color: var(--secondary-color)">Sauvegarde effectuée</h3>
        <p>
          Le téléchargement de votre dessin (mon-dessin.png) a été effectuée.
        </p>
        <p style="font-size: 0.9em; color: #777">
          *Note : Le fichier est enregistré dans votre dossier de téléchargement
          par défaut. Le navigateur ne permet pas de choisir le répertoire pour
          des raisons de sécurité.
        </p>
        <div class="modal-actions">
          <button
            class="modal-button"
            id="closeSaveModal"
            style="background-color: var(--primary-color); color: white"
          >
            Fermer
          </button>
        </div>
      </div>
    </div>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("drawingCanvas");
        const ctx = canvas.getContext("2d");
        const colorPicker = document.getElementById("colorPicker");
        const brushSize = document.getElementById("brushSize");
        const brushSizeValue = document.getElementById("brushSizeValue");
        const opacitySlider = document.getElementById("opacitySlider");
        const opacityValue = document.getElementById("opacityValue");
        const brushButton = document.getElementById("brushButton");
        const eraserButton = document.getElementById("eraserButton");
        const fillButton = document.getElementById("fillButton");
        const clearButton = document.getElementById("clearButton");
        const saveButton = document.getElementById("saveButton");
        const sizeButton = document.getElementById("sizeButton");
        const sizeRangePopup = document.getElementById("sizeRangePopup");
        const opacityButton = document.getElementById("opacityButton");
        const opacityRangePopup = document.getElementById("opacityRangePopup");
        const clearModal = document.getElementById("clearModal");
        const confirmClearButton = document.getElementById("confirmClear");
        const cancelClearButton = document.getElementById("cancelClear");
        const saveModal = document.getElementById("saveModal");
        const closeSaveModalButton = document.getElementById("closeSaveModal");

        let isSaving = false;
        let isDrawing = false;
        let currentTool = "brush";
        let lastX = 0;
        let lastY = 0;
        let currentColor = "#000000";
        let currentAlpha = 1.0;

        brushButton.classList.add("active");
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = 5;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.globalAlpha = currentAlpha;

        function getMousePos(e) {
          const rect = canvas.getBoundingClientRect();
          return { x: e.clientX - rect.left, y: e.clientY - rect.top };
        }

        function startDrawing(e) {
          if (currentTool === "brush" || currentTool === "eraser") {
            isDrawing = true;
            const pos = getMousePos(e);
            [lastX, lastY] = [pos.x, pos.y];
            drawPoint(pos.x, pos.y);
          }
        }

        function draw(e) {
          if (!isDrawing) return;
          const pos = getMousePos(e);
          const dist = Math.sqrt(
            Math.pow(pos.x - lastX, 2) + Math.pow(pos.y - lastY, 2)
          );
          if (dist > 1) {
            const segments = Math.ceil(dist / 1);
            for (let i = 0; i < segments; i++) {
              const x = lastX + ((pos.x - lastX) * i) / segments;
              const y = lastY + ((pos.y - lastY) * i) / segments;
              drawPoint(x, y);
            }
          } else {
            drawPoint(pos.x, pos.y);
          }
          [lastX, lastY] = [pos.x, pos.y];
        }

        function drawPoint(x, y) {
          ctx.beginPath();
          ctx.arc(x, y, ctx.lineWidth / 2, 0, Math.PI * 2);
          ctx.fillStyle = ctx.strokeStyle;
          ctx.fill();
        }

        function stopDrawing() {
          isDrawing = false;
          ctx.beginPath();
        }

        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseout", stopDrawing);
      });
    </script>
  </body>
</html>
